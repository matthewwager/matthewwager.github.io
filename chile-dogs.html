<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chile Dogs - OtterArts</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Protest+Riot&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        .slideshow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-color: #000000;
        }

        .slideshow-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            transition: transform 0.6s ease-in-out;
        }

        .slide {
            min-width: 100%;
            width: 100%;
            height: 100vh;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .slide__background,
        .slide__middleground,
        .slide__foreground {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            opacity: 0;
        }

        .slide__background {
            z-index: 1;
            background: #000000;
        }

        .slide__middleground {
            z-index: 2;
            background: transparent;
        }

        .slide__foreground {
            z-index: 3;
            background: transparent;
        }

        .slide.active .slide__background {
            animation: fadeIn 0.6s ease-in-out 0.1s forwards;
        }

        .slide.active .slide__middleground {
            animation: fadeIn 0.6s ease-in-out 0.3s forwards;
        }

        .slide.active .slide__foreground {
            animation: fadeIn 0.6s ease-in-out 0.5s forwards;
        }

        /* Initial animation only triggers when slide first becomes active */
        .slide.active[data-just-activated] .slide__caption[data-caption-index="0"].active {
            animation: fadeIn 0.6s ease-in-out 0.7s forwards;
        }

        /* For caption changes within the same slide, use transition only (no animation) */
        .slide.active .slide__caption[data-caption-index].active {
            animation: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .slide__background img,
        .slide__middleground img,
        .slide__foreground img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            min-height: 0;
        }

        .slide__placeholder {
            padding: 24px;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 18px;
            color: var(--color-white);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .slide__caption {
            position: absolute;
            z-index: 4;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            font-family: 'Protest Riot', sans-serif;
            font-weight: 400;
            font-size: 16px;
            line-height: 1.5;
            color: var(--color-white);
            max-width: 400px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease-in-out;
        }

        /* Hide all captions by default */
        .slide__caption[data-caption-index] {
            opacity: 0;
            display: block;
        }

        /* Show active caption */
        .slide__caption[data-caption-index].active {
            opacity: 1;
        }

        /* Caption position variants */
        .slide__caption--top-left {
            top: 48px;
            left: 48px;
        }

        .slide__caption--top-center {
            top: 48px;
            left: 50%;
            transform: translateX(-50%);
        }

        .slide__caption--top-right {
            top: 48px;
            right: 48px;
        }

        .slide__caption--bottom-left {
            bottom: 48px;
            left: 48px;
        }

        .slide__caption--bottom-center {
            bottom: 48px;
            left: 50%;
            transform: translateX(-50%);
        }

        .slide__caption--bottom-right {
            bottom: 48px;
            right: 48px;
        }

        .slideshow-nav {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: var(--color-white);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0.4;
            padding: 0;
        }

        .slideshow-nav:hover,
        .slideshow-nav:active {
            opacity: 1;
            border-color: rgba(255, 255, 255, 1);
            background: rgba(255, 255, 255, 0.1);
        }

        .slideshow-nav svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .slideshow-nav--prev {
            left: 24px;
        }

        .slideshow-nav--next {
            right: 24px;
        }

        .slide-indicator {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 1000;
        }

        .slide-indicator__dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slide-indicator__dot--active {
            background: var(--color-white);
            width: 24px;
            border-radius: 6px;
        }



        @media (max-width: 768px) {
            /* Hide navigation buttons on mobile */
            .slideshow-nav {
                display: none;
            }

            /* Center caption at top, full width on mobile */
            .slide__caption {
                font-size: 14px;
                padding: 16px 24px;
                max-width: 100%;
                width: calc(100% - 32px);
                left: 50% !important;
                right: auto !important;
                top: 16px !important;
                bottom: auto !important;
                transform: translateX(-50%);
            }

            .slide__placeholder {
                font-size: 14px;
            }

            .slide__background img,
            .slide__middleground img,
            .slide__foreground img {
                min-height: 768px;
            }
        }

        /* Mobile portrait viewport - stop scaling at 768px height */
        @media (max-width: 768px) and (orientation: portrait) {
            .slide__background img,
            .slide__middleground img,
            .slide__foreground img {
                min-height: 768px;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Fixed Background Image -->
    <div class="background-image">
        <img src="images/background-image.svg" alt="" aria-hidden="true">
    </div>

    <div class="slideshow-container">
        <div class="slideshow-wrapper" id="slideshowWrapper">
            <!-- Slide 1 -->
            <div class="slide">
                <div class="slide__background">
                    <div class="slide__placeholder">Background</div>
                </div>
                <div class="slide__middleground">
                    <div class="slide__placeholder">Middleground</div>
                </div>
                <div class="slide__foreground">
                    <div class="slide__placeholder">Foreground</div>
                </div>
                <div class="slide__caption slide__caption--bottom-center" data-caption-index="0">
                    Caption: Online graphic novel about the street dogs of Valparaiso, written and illustrated by me.
                </div>
            </div>

            <!-- Slide 2 -->
            <div class="slide">
                <div class="slide__background">
                    <img src="chile-dogs/images/background_03.svg" alt="Background">
                </div>
                <div class="slide__middleground">
                    <img src="chile-dogs/images/middleground_03.svg" alt="Middleground">
                </div>
                <div class="slide__foreground">
                    <img src="chile-dogs/images/foreground_03.svg" alt="Foreground">
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="0">
                    As they reached the clearing, she brought her opening number to a rousing conclusion. Dozens of dogs gathered, drawn by her voice, while uniformed men installing loudspeakers and placards nearby scowled at the performance.
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="1">
                    Their heckles, however, were drowned out by the enthusiastic howls of the growing audience. Violeta sang well past dusk, her melodies carrying into twilight.
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="2">
                    She closed with familiar anthems, and the assembled dogs barked and howled their appreciation. As the applause lingered, Violeta spotted Pablo among the crowd. Knowing his gift for words, she motioned for silence and invited him to recite a poem.
                </div>
            </div>

            <!-- Slide 3 -->
            <div class="slide">
                <div class="slide__background">
                    <img src="chile-dogs/images/background_00.svg" alt="Background">
                </div>
                <div class="slide__middleground">
                    <img src="chile-dogs/images/middleground_00.svg" alt="Middleground">
                </div>
                <div class="slide__foreground">
                    <img src="chile-dogs/images/foreground_00.svg" alt="Foreground">
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="0">
                    Pablo hesitated at first, but the rising chorus of pleas coaxed him forward. He began softly, his voice weaving through the night air.
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="1">
                    He spoke of the kind-hearted people of Valpara√≠so, then his tone deepened as he lamented the growing harassment from the uniformed men and the troubling disappearance of many friends.
                </div>
                <div class="slide__caption slide__caption--top-left" data-caption-index="2">
                    His words swelled into a powerful refrain, one familiar to all:<br><br>Joyful, joyful, joyful,<br>as only dogs know how to be happy<br>with only the autonomy<br>of our shameless spirit!
                </div>
            </div>

            <!-- Slide 4 -->
            <div class="slide">
                <div class="slide__background">
                    <img src="chile-dogs/images/background_01.svg" alt="Background">
                </div>
                <div class="slide__middleground">
                    <img src="chile-dogs/images/middleground_01.svg" alt="Middleground">
                </div>
                <div class="slide__foreground">
                    <img src="chile-dogs/images/foreground_01.svg" alt="Foreground">
                </div>
                <div class="slide__caption slide__caption--top-right" data-caption-index="0">
                    After the applause faded, the crowd broke into murmuring conversations that stretched late into the night.
                </div>
                <div class="slide__caption slide__caption--top-right" data-caption-index="1">
                    One by one, the dogs succumbed to sleep, curling together for warmth beneath a sky ablaze with stars.
                </div>
                <div class="slide__caption slide__caption--top-right" data-caption-index="2">
                    Below, the city lights flickered out, leaving only the soft glow of the heavens.
                </div>
            </div>

            <!-- Slide 3 -->
            <div class="slide">
                <div class="slide__background">
                    <div class="slide__placeholder">Background</div>
                </div>
                <div class="slide__middleground">
                    <div class="slide__placeholder">Middleground</div>
                </div>
                <div class="slide__foreground">
                    <div class="slide__placeholder">Foreground</div>
                </div>
                <div class="slide__caption slide__caption--bottom-right">
                    Caption: Slide 3 - Bottom Right
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <button class="slideshow-nav slideshow-nav--prev" id="prevBtn" aria-label="Previous slide">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="slideshow-nav slideshow-nav--next" id="nextBtn" aria-label="Next slide">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <!-- Slide Indicator -->
        <div class="slide-indicator" id="slideIndicator"></div>
    </div>

    <script>
        (function() {
            const wrapper = document.getElementById('slideshowWrapper');
            const slides = wrapper.querySelectorAll('.slide');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const slideIndicator = document.getElementById('slideIndicator');
            
            let currentSlide = 0;
            let currentCaptionIndex = 0;
            let isScrolling = false;
            let scrollTimeout;

            // Get all captions for a slide
            function getCaptions(slideIndex) {
                return slides[slideIndex].querySelectorAll('[data-caption-index]');
            }

            // Get count of captions for a slide
            function getCaptionCount(slideIndex) {
                return getCaptions(slideIndex).length || 1; // Default to 1 if no captions
            }

            // Initialize slide indicators
            slides.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = 'slide-indicator__dot';
                if (index === 0) dot.classList.add('slide-indicator__dot--active');
                dot.addEventListener('click', () => {
                    goToSlide(index);
                    currentCaptionIndex = 0; // Reset caption index when jumping to slide
                    updateCaptions();
                });
                slideIndicator.appendChild(dot);
            });

            // Update caption visibility
            function updateCaptions() {
                const captions = getCaptions(currentSlide);
                captions.forEach((caption, index) => {
                    if (index === currentCaptionIndex) {
                        caption.classList.add('active');
                    } else {
                        caption.classList.remove('active');
                    }
                });
            }

            // Update slide position
            function updateSlidePosition() {
                // Remove active class and activation flag from all slides
                slides.forEach(slide => {
                    slide.classList.remove('active');
                    slide.removeAttribute('data-just-activated');
                });
                
                // Add active class and activation flag to current slide to trigger initial animations
                const currentSlideElement = slides[currentSlide];
                currentSlideElement.classList.add('active');
                currentSlideElement.setAttribute('data-just-activated', 'true');
                
                // Remove activation flag after animation completes
                setTimeout(() => {
                    currentSlideElement.removeAttribute('data-just-activated');
                }, 1500); // After all animations complete (0.7s delay + 0.6s duration + buffer)
                
                wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
                updateIndicators();
                updateCaptions();
            }

            // Update indicators
            function updateIndicators() {
                const dots = slideIndicator.querySelectorAll('.slide-indicator__dot');
                dots.forEach((dot, index) => {
                    if (index === currentSlide) {
                        dot.classList.add('slide-indicator__dot--active');
                    } else {
                        dot.classList.remove('slide-indicator__dot--active');
                    }
                });
            }

            // Go to specific slide
            function goToSlide(index) {
                if (index < 0) index = 0;
                if (index >= slides.length) index = slides.length - 1;
                currentSlide = index;
                currentCaptionIndex = 0; // Reset to first caption when jumping to slide
                updateSlidePosition();
            }

            // Next slide or caption
            function nextSlide() {
                const captionCount = getCaptionCount(currentSlide);
                
                // If there are more captions on this slide, advance caption
                if (currentCaptionIndex < captionCount - 1) {
                    currentCaptionIndex++;
                    updateCaptions();
                } 
                // Otherwise, advance to next slide
                else if (currentSlide < slides.length - 1) {
                    currentSlide++;
                    currentCaptionIndex = 0;
                    updateSlidePosition();
                }
            }

            // Previous slide or caption
            function prevSlide() {
                // If not at first caption, go to previous caption
                if (currentCaptionIndex > 0) {
                    currentCaptionIndex--;
                    updateCaptions();
                } 
                // Otherwise, go to previous slide's last caption
                else if (currentSlide > 0) {
                    currentSlide--;
                    const captionCount = getCaptionCount(currentSlide);
                    currentCaptionIndex = Math.max(0, captionCount - 1);
                    updateSlidePosition();
                }
            }

            // Handle scroll events
            let lastScrollTime = 0;
            let scrollDirection = 0;

            function handleWheel(e) {
                e.preventDefault();
                
                const now = Date.now();
                if (now - lastScrollTime < 100) return; // Throttle
                lastScrollTime = now;

                const delta = e.deltaY;
                
                if (delta > 0) {
                    // Scroll down - next slide
                    nextSlide();
                } else if (delta < 0) {
                    // Scroll up - previous slide
                    prevSlide();
                }
            }

            // Keyboard navigation
            function handleKeyDown(e) {
                switch(e.key) {
                    case 'ArrowRight':
                    case 'ArrowDown':
                        e.preventDefault();
                        nextSlide();
                        break;
                    case 'ArrowLeft':
                    case 'ArrowUp':
                        e.preventDefault();
                        prevSlide();
                        break;
                }
            }

            // Click on slide to advance
            slides.forEach(slide => {
                slide.addEventListener('click', (e) => {
                    // Don't advance if clicking on navigation buttons
                    if (e.target.closest('.slideshow-nav')) return;
                    nextSlide();
                });
            });

            // Button navigation
            prevBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                prevSlide();
            });

            nextBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                nextSlide();
            });

            // Event listeners
            window.addEventListener('wheel', handleWheel, { passive: false });
            window.addEventListener('keydown', handleKeyDown);

            // Prevent default touch behaviors on mobile
            let touchStartY = 0;
            let touchEndY = 0;

            wrapper.addEventListener('touchstart', (e) => {
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });

            wrapper.addEventListener('touchend', (e) => {
                touchEndY = e.changedTouches[0].screenY;
                handleSwipe();
            }, { passive: true });

            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartY - touchEndY;

                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Swipe up - next slide
                        nextSlide();
                    } else {
                        // Swipe down - previous slide
                        prevSlide();
                    }
                }
            }

            // Initialize
            // Set first slide as active on load
            slides[0].classList.add('active');
            currentCaptionIndex = 0;
            updateSlidePosition();
        })();
    </script>
</body>
</html>
